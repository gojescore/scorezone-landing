<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scorezone ‚Äì Plus/Minus Hj√¶lper</title>
  <style>
    :root{
      --bgA:#7c3aed;
      --bgB:#06b6d4;
      --bgC:#f97316;

      --card:#ffffff;
      --card2:#f8fafc;

      --ink:#0f172a;
      --muted:#475569;

      --good:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;

      --border: rgba(15, 23, 42, 0.14);
      --shadow: 0 14px 30px rgba(15,23,42,0.18);
      --radius: 18px;

      --cube: 30px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:16px;
      color:var(--ink);
      background:
        radial-gradient(900px 600px at 15% 15%, rgba(124,58,237,0.35), transparent 60%),
        radial-gradient(900px 600px at 85% 20%, rgba(6,182,212,0.35), transparent 55%),
        radial-gradient(900px 600px at 50% 90%, rgba(249,115,22,0.22), transparent 60%),
        #f1f5f9;
    }

    .app{
      width:min(1050px, 100%);
      background:rgba(255,255,255,0.72);
      backdrop-filter: blur(8px);
      border:1px solid rgba(15,23,42,0.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:14px 16px;
      background: linear-gradient(90deg, rgba(124,58,237,0.18), rgba(6,182,212,0.16), rgba(249,115,22,0.14));
      border-bottom:1px solid rgba(15,23,42,0.10);
    }
    header .title{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width: 220px;
    }
    header .title strong{
      font-size:1.05rem;
      letter-spacing:0.2px;
    }
    header .title div{
      font-size:0.92rem;
      color: rgba(15,23,42,0.70);
      font-weight: 650;
    }

    .headerStars{
      flex: 1;
      display:flex;
      align-items:center;
      justify-content:center;
      min-width: 260px;
    }
    .stars{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding:6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.60);
      border: 1px solid rgba(15,23,42,0.10);
      user-select:none;
    }
    .star{
      width: 26px;
      height: 26px;
      display:grid;
      place-items:center;
      font-size: 1.25rem;
      line-height: 1;
      transform-origin: center;
      filter: drop-shadow(0 6px 10px rgba(15,23,42,0.12));
      opacity: 0.55;
    }
    .star.filled{
      opacity: 1;
      filter:
        drop-shadow(0 6px 10px rgba(15,23,42,0.10))
        drop-shadow(0 0 14px rgba(249,115,22,0.55));
    }
    .star.filled.glow{
      animation: starGlow 900ms ease-in-out infinite;
    }
    .star.pop{ animation: starPop 520ms ease-out forwards; }
    .star.dance{ animation: starDance 700ms ease-in-out forwards; }

    .starsHelp{
      margin-left: 10px;
      font-weight: 950;
      color: rgba(15,23,42,0.62);
      font-size: 0.9rem;
      white-space: nowrap;
    }
    @keyframes starPop{
      0%   { transform: scale(0.85) rotate(-8deg); }
      45%  { transform: scale(1.28) rotate(8deg); }
      100% { transform: scale(1) rotate(0deg); }
    }
    @keyframes starDance{
      0%   { transform: translateY(0) rotate(0deg); }
      25%  { transform: translateY(-5px) rotate(-6deg); }
      55%  { transform: translateY(0) rotate(6deg); }
      80%  { transform: translateY(-3px) rotate(-4deg); }
      100% { transform: translateY(0) rotate(0deg); }
    }
    @keyframes starGlow{
      0%   { filter: drop-shadow(0 6px 10px rgba(15,23,42,0.10)) drop-shadow(0 0 10px rgba(249,115,22,0.35)); }
      50%  { filter: drop-shadow(0 6px 10px rgba(15,23,42,0.10)) drop-shadow(0 0 18px rgba(249,115,22,0.75)); }
      100% { filter: drop-shadow(0 6px 10px rgba(15,23,42,0.10)) drop-shadow(0 0 10px rgba(249,115,22,0.35)); }
    }
    @media (max-width: 760px){
      .headerStars{ display:none; }
    }

    .streakPill{
      display:flex;
      align-items:center;
      gap:10px;
      padding:8px 12px;
      border-radius:999px;
      background: rgba(255,255,255,0.78);
      border:1px solid rgba(15,23,42,0.12);
      font-weight: 950;
      user-select:none;
      white-space:nowrap;
    }
    .dot{
      width:11px; height:11px;
      border-radius:999px;
      background: var(--good);
      box-shadow: 0 0 0 6px rgba(22,163,74,0.18);
    }

    main{ padding:14px 16px 16px; display:grid; gap:12px; }

    .card{
      background: rgba(255,255,255,0.88);
      border:1px solid rgba(15,23,42,0.10);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: 0 10px 22px rgba(15,23,42,0.08);
    }

    .row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }

    label{ font-weight: 1000; }
    input[type="text"], input[type="number"]{
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid rgba(15,23,42,0.16);
      background: #ffffff;
      font-size: 1rem;
      outline:none;
    }

    .btn{
      border:1px solid rgba(15,23,42,0.14);
      background: #ffffff;
      padding:10px 14px;
      border-radius: 16px;
      font-weight: 1000;
      cursor:pointer;
      user-select:none;
      transition: transform 80ms ease, box-shadow 120ms ease;
      box-shadow: 0 8px 18px rgba(15,23,42,0.08);
    }
    .btn:active{ transform: translateY(1px); box-shadow: 0 6px 14px rgba(15,23,42,0.08); }
    .btn.primary{
      background: linear-gradient(135deg, rgba(34,197,94,0.24), rgba(6,182,212,0.18));
      border-color: rgba(22,163,74,0.22);
    }

    /* NEW: clearer back button */
    .btn.back{
      background: linear-gradient(135deg, rgba(124,58,237,0.30), rgba(6,182,212,0.16), rgba(249,115,22,0.10));
      border-color: rgba(124,58,237,0.30);
      box-shadow: 0 10px 22px rgba(15,23,42,0.10);
    }

    .pill-group{ display:flex; gap:8px; flex-wrap:wrap; }
    .pill{
      padding:9px 12px;
      border-radius: 999px;
      border:1px solid rgba(15,23,42,0.14);
      background:#ffffff;
      font-weight: 1000;
      cursor:pointer;
      user-select:none;
    }
    .pill[aria-pressed="true"]{
      background: linear-gradient(135deg, rgba(124,58,237,0.18), rgba(6,182,212,0.16));
      border-color: rgba(124,58,237,0.24);
    }

    .subtle{
      color: rgba(15,23,42,0.62);
      font-weight: 850;
      font-size: 0.95rem;
    }

    .hidden{ display:none !important; }

    .gameGrid{ display:grid; gap: 12px; }
    .topBar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:10px;
    }

    .equationCard{
      background: var(--card);
      border:1px solid rgba(15,23,42,0.10);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: 0 10px 20px rgba(15,23,42,0.08);
    }

    .equationTop{
      display:grid;
      grid-template-columns: 1fr 90px 1fr;
      gap: 10px;
      align-items: start;
    }

    @media (max-width: 760px){
      .equationTop{ grid-template-columns: 1fr; }
      .opSign{ display:none; }
      .opSignMobile{ display:flex; }
    }

    .opSign{
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 4.2rem;
      font-weight: 1100;
      color: rgba(15,23,42,0.70);
      line-height:1;
      user-select:none;
    }
    .opSignMobile{
      display:none;
      align-items:center;
      justify-content:center;
      font-size: 3.4rem;
      font-weight: 1100;
      color: rgba(15,23,42,0.70);
      line-height:1;
      user-select:none;
    }

    .side{ display:grid; gap: 10px; }
    .bigNumber{
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 3.6rem;
      font-weight: 1100;
      padding: 8px 10px;
      border-radius: 18px;
      background: linear-gradient(135deg, rgba(249,115,22,0.18), rgba(124,58,237,0.14));
      border:1px solid rgba(15,23,42,0.10);
      user-select:none;
    }
    .bigNumber.primaryPick{
      outline: 5px solid rgba(124,58,237,0.35);
      border-color: rgba(124,58,237,0.45);
      background: linear-gradient(135deg, rgba(124,58,237,0.22), rgba(6,182,212,0.12), rgba(249,115,22,0.12));
      transform: translateY(-2px);
    }

    .hint{
      text-align:center;
      font-weight: 950;
      color: rgba(15,23,42,0.62);
      font-size: 0.95rem;
      margin-top: -2px;
    }

    .dropZone{
      min-height: calc(var(--cube) * 2.2);
      padding: 10px;
      border-radius: 18px;
      background: #f8fafc;
      border: 3px dashed rgba(15,23,42,0.18);
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      align-content:flex-start;
    }
    .dropZone.correct{
      border-color: rgba(22,163,74,0.55);
      background: rgba(22,163,74,0.08);
    }
    .dropZone.wrong{
      border-color: rgba(239,68,68,0.55);
      background: rgba(239,68,68,0.08);
    }

    .pileWrap{
      background: var(--card);
      border:1px solid rgba(15,23,42,0.10);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: 0 10px 20px rgba(15,23,42,0.08);
    }

    .pileHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .pileHeader strong{
      font-size: 1.05rem;
      font-weight: 1100;
    }
    .pileHeader span{
      color: rgba(15,23,42,0.62);
      font-weight: 900;
    }

    .pileArea{
      min-height: 170px;
      padding: 10px;
      border-radius: 18px;
      background: #f8fafc;
      border: 3px dashed rgba(15,23,42,0.18);
      display:flex;
      flex-wrap:wrap;
      gap: 8px;
      align-content:flex-start;
    }

    .cube{
      width: var(--cube);
      height: var(--cube);
      border-radius: 10px;
      border: 1px solid rgba(15,23,42,0.14);
      box-shadow: 0 6px 14px rgba(15,23,42,0.12);
      user-select:none;
      touch-action:none;
      position: relative;
      cursor: grab;
    }
    .cube:active{ cursor: grabbing; }

    .cube.crossed{
      opacity: 0.45;
      filter: saturate(0.8);
    }
    .cube.crossed::after{
      content:"";
      position:absolute;
      left:-6px;
      right:-6px;
      top: calc(50% - 2px);
      height: 4px;
      background: rgba(239,68,68,0.92);
      transform: rotate(-18deg);
      border-radius: 999px;
      box-shadow: 0 0 0 2px rgba(239,68,68,0.18);
    }

    .cube.static{
      cursor: default;
      touch-action: auto;
    }

    .actions{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }

    .message{
      min-height: 26px;
      font-weight: 1000;
      color: rgba(15,23,42,0.70);
    }
    .message.good{ color: var(--good); }
    .message.warn{ color: #b45309; }
    .message.bad{ color: var(--bad); }

    .questionCard{
      background: var(--card);
      border:1px solid rgba(15,23,42,0.10);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: 0 10px 20px rgba(15,23,42,0.08);
      display:grid;
      gap: 8px;
    }
    .qRow{
      display:flex;
      flex-wrap:wrap;
      gap: 10px;
      align-items:center;
    }
    .qText{
      font-size: 1.55rem;
      font-weight: 1100;
    }

    .ghost{
      position: fixed;
      z-index: 10000;
      pointer-events: none;
      opacity: 0.95;
      transform: translate(0,0);
      box-shadow: 0 18px 40px rgba(15,23,42,0.22) !important;
    }

    .lineWrap{
      background: var(--card);
      border:1px solid rgba(15,23,42,0.10);
      border-radius: var(--radius);
      padding: 14px;
      box-shadow: 0 10px 20px rgba(15,23,42,0.08);
      display:grid;
      gap:10px;
    }
    .lineTitle{
      font-weight:1100;
      color: rgba(15,23,42,0.72);
      display:flex;
      justify-content:center;
      user-select:none;
    }
    .line{
      display:flex;
      gap:6px;
      align-items:flex-end;
      justify-content:space-between;
      user-select:none;
      position: relative;
    }
    .tick{
      flex:1;
      border-radius: 14px;
      padding: 12px 0;
      text-align:center;
      border:1px solid rgba(15,23,42,0.12);
      background: linear-gradient(135deg, rgba(124,58,237,0.10), rgba(6,182,212,0.08), rgba(249,115,22,0.08));
      font-weight:1100;
      color: rgba(15,23,42,0.75);
      position: relative;
    }
    .tick.clickable{
      cursor: pointer;
      transition: transform 80ms ease, box-shadow 120ms ease;
    }
    .tick.clickable:active{ transform: translateY(1px); }

    .tick.active{
      outline: 4px solid rgba(124,58,237,0.35);
      border-color: rgba(124,58,237,0.45);
      background: linear-gradient(135deg, rgba(124,58,237,0.18), rgba(6,182,212,0.10), rgba(249,115,22,0.10));
      transform: translateY(-3px);
    }
    .tick.active::after{
      content:"";
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom:-10px;
      width:0; height:0;
      border-left:8px solid transparent;
      border-right:8px solid transparent;
      border-top:10px solid rgba(124,58,237,0.35);
    }

    .sliderRow{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .sliderTrack{
      width: 100%;
      max-width: 100%;
      display:flex;
      justify-content:center;
    }
    .sliderInner{ width: 100%; }
    input[type="range"]{
      width: 100%;
      accent-color: var(--bgA);
      margin: 0;
    }
    .sliderPill{
      padding:8px 12px;
      border-radius:999px;
      background: rgba(255,255,255,0.9);
      border:1px solid rgba(15,23,42,0.14);
      font-weight:1100;
      color: rgba(15,23,42,0.78);
      user-select:none;
      white-space: nowrap;
    }

    .monster{
      position: fixed;
      width: 160px;
      height: 120px;
      border-radius: 22px;
      background: rgba(255,255,255,0.92);
      border: 1px solid rgba(15,23,42,0.14);
      box-shadow: 0 18px 35px rgba(15,23,42,0.18);
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap: 6px;
      opacity: 0;
      pointer-events:none;
      transform-origin: center;
      will-change: transform, opacity, left, top;
      z-index: 999999;
      left: 0;
      top: 0;
    }
    .monster .face{ font-size: 2.8rem; line-height: 1; }
    .monster .label{
      font-weight: 1100;
      color: rgba(15,23,42,0.70);
      font-size: 0.95rem;
    }

    .monster.show{ opacity: 1; }
    .monster.run-in{ opacity: 1; animation: monsterIn 420ms ease-out forwards; }
    .monster.run-chomp{ opacity: 1; animation: monsterChomp 520ms ease-in-out forwards; }
    .monster.run-turn{ opacity: 1; animation: monsterTurn 260ms ease-in-out forwards; }
    .monster.run-out{ opacity: 1; animation: monsterOut 420ms ease-in forwards; }

    @keyframes monsterIn{
      from { transform: translateX(260px) scale(0.95) rotateY(0deg); }
      to   { transform: translateX(0) scale(1) rotateY(0deg); }
    }
    @keyframes monsterChomp{
      0%   { transform: translateX(0) scale(1) rotateY(0deg); }
      25%  { transform: translateX(0) scale(1.05) rotateY(0deg); }
      55%  { transform: translateX(0) scale(0.98) rotateY(0deg); }
      100% { transform: translateX(0) scale(1) rotateY(0deg); }
    }
    @keyframes monsterTurn{
      0%   { transform: translateX(0) scale(1) rotateY(0deg); }
      100% { transform: translateX(0) scale(1) rotateY(180deg); }
    }
    @keyframes monsterOut{
      from { transform: translateX(0) scale(1) rotateY(180deg); }
      to   { transform: translateX(260px) scale(0.95) rotateY(180deg); }
    }
  </style>
</head>

<body>
  <div class="app">
    <header>
      <div class="title">
        <strong>Plus/Minus Hj√¶lper</strong>
        <div>V√¶lg p√• startsiden ‚Äì l√∏s p√• spilsiden</div>
      </div>

      <div class="headerStars" aria-hidden="false">
        <div class="stars" id="stars" aria-label="Stjerner (rekord for denne √∏velse)">
          <span class="star" data-i="1">‚òÜ</span>
          <span class="star" data-i="2">‚òÜ</span>
          <span class="star" data-i="3">‚òÜ</span>
          <span class="star" data-i="4">‚òÜ</span>
          <span class="star" data-i="5">‚òÜ</span>
        </div>
        <div class="starsHelp" id="starsHelp" title="Rekordstjerner: 1 stjerne for hver 5 i bedste streak">Best</div>
      </div>

      <div class="streakPill" title="Streak for den valgte √∏velse">
        <span class="dot"></span>
        <span>Streak: <span id="streakHeader">0</span></span>
      </div>
    </header>

    <main>
      <section class="card" id="startScreen">
        <div class="row" style="justify-content:space-between;">
          <div class="row">
            <label for="studentName">Navn:</label>
            <input id="studentName" type="text" placeholder="Skriv dit navn" autocomplete="off" />
          </div>
          <div class="subtle" id="helloText"></div>
        </div>

        <hr style="border:none; border-top:1px solid rgba(15,23,42,0.10); margin: 12px 0;"/>

        <div class="row">
          <label>V√¶lg:</label>
          <div class="pill-group" role="group" aria-label="Plus eller minus">
            <button class="pill" id="opPlus" aria-pressed="true">Plus (+)</button>
            <button class="pill" id="opMinus" aria-pressed="false">Minus (‚àí)</button>
          </div>

          <label style="margin-left: 10px;">Level:</label>
          <div class="pill-group" role="group" aria-label="Level">
            <button class="pill" id="lvl1" aria-pressed="true">Level 1</button>
            <button class="pill" id="lvl2" aria-pressed="false">Level 2</button>
            <button class="pill" id="lvl3" aria-pressed="false">Level 3</button>
          </div>

          <button class="btn primary" id="goBtn" style="margin-left:auto;">G√• til √∏velsen</button>
        </div>

        <div class="subtle" style="margin-top:8px;" id="startStreakText">
          Din streak for denne √∏velse: 0
        </div>

        <div class="subtle" style="margin-top:6px;">
          Level 1: sm√• tal (plus sum ‚â§ 9, minus uden negative) + svar via tallinje. Level 2: plus sum ‚â§ 9 (drag) / minus (tryk og kryds ud). Level 3: tallinje 0‚Äì30 + slider (plus sum ‚â§ 30).
        </div>
      </section>

      <section class="card hidden" id="gameScreen">
        <div class="topBar">
          <div class="row">
            <button class="btn back" id="backBtn">‚Üê Tilbage</button>
            <div class="subtle" id="modeText"></div>
          </div>
          <div class="streakPill">
            <span class="dot"></span>
            <span>Streak: <span id="streakGame">0</span></span>
          </div>
        </div>

        <div class="gameGrid" style="margin-top:10px;">
          <div class="equationCard">
            <div class="equationTop">
              <div class="side">
                <div class="bigNumber" id="n1">?</div>
                <div class="hint" id="hint1">Tr√¶k klodser herned</div>
                <div class="dropZone" id="zone1" aria-label="Boks 1"></div>
              </div>

              <div class="opSign" id="opSign">+</div>
              <div class="opSignMobile" id="opSignMobile">+</div>

              <div class="side">
                <div class="bigNumber" id="n2">?</div>
                <div class="hint" id="hint2">Tr√¶k klodser herned</div>
                <div class="dropZone" id="zone2" aria-label="Boks 2"></div>
              </div>
            </div>

            <div class="actions">
              <div class="message" id="cubeMsg"></div>
              <div class="row">
                <button class="btn primary" id="klarBtn">Klar</button>
              </div>
            </div>
          </div>

          <div class="lineWrap" id="lineWrap">
            <div class="lineTitle" id="lineTitle">Tallinje</div>
            <div class="line" id="line"></div>

            <div class="sliderRow hidden" id="sliderRow">
              <div class="sliderTrack" id="sliderTrack">
                <div class="sliderInner">
                  <input type="range" id="lineSlider" min="0" max="30" value="0" />
                </div>
              </div>
              <div class="sliderPill" id="sliderPill">Slider: 0</div>
            </div>
          </div>

          <div class="pileWrap" id="pileWrap">
            <div class="pileHeader">
              <strong id="pileTitle">Klodse-bunke</strong>
              <span id="pileHint">Tr√¶k klodser op i boksene</span>
            </div>
            <div class="pileArea" id="pileArea" aria-label="Klodse bunke"></div>
          </div>

          <div class="questionCard hidden" id="questionCard">
            <div class="qRow">
              <div class="qText" id="qText">Hvad er 1 + 2?</div>
              <input id="answerInput" type="number" inputmode="numeric" style="width:120px;" />
              <button class="btn primary" id="svarBtn">Svar</button>
            </div>
            <div class="message" id="answerMsg"></div>
            <div class="subtle" id="streakAck"></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div class="monster" id="monster" aria-hidden="true">
    <div class="face">üëæ</div>
    <div class="label">Nom nom!</div>
  </div>

<script>
(() => {
  const state = {
    name: "",
    op: "plus",
    level: 1,
    n1: 0,
    n2: 0,
    streak: 0,
    pendingMinusReward: false,

    lastProblemKey: "",
    round: 0,

    bestStars: 0,
    lastBestStarsRendered: 0
  };

  const cubeColors = ["#60a5fa", "#34d399", "#fb7185", "#fbbf24", "#a78bfa", "#22d3ee", "#f97316"];

  const el = {
    startScreen: document.getElementById("startScreen"),
    gameScreen: document.getElementById("gameScreen"),

    studentName: document.getElementById("studentName"),
    helloText: document.getElementById("helloText"),
    startStreakText: document.getElementById("startStreakText"),
    goBtn: document.getElementById("goBtn"),

    opPlus: document.getElementById("opPlus"),
    opMinus: document.getElementById("opMinus"),
    lvl1: document.getElementById("lvl1"),
    lvl2: document.getElementById("lvl2"),
    lvl3: document.getElementById("lvl3"),

    streakHeader: document.getElementById("streakHeader"),
    backBtn: document.getElementById("backBtn"),
    modeText: document.getElementById("modeText"),
    streakGame: document.getElementById("streakGame"),

    n1: document.getElementById("n1"),
    n2: document.getElementById("n2"),
    hint1: document.getElementById("hint1"),
    hint2: document.getElementById("hint2"),
    opSign: document.getElementById("opSign"),
    opSignMobile: document.getElementById("opSignMobile"),

    zone1: document.getElementById("zone1"),
    zone2: document.getElementById("zone2"),

    pileWrap: document.getElementById("pileWrap"),
    pileTitle: document.getElementById("pileTitle"),
    pileHint: document.getElementById("pileHint"),
    pileArea: document.getElementById("pileArea"),

    cubeMsg: document.getElementById("cubeMsg"),
    klarBtn: document.getElementById("klarBtn"),

    questionCard: document.getElementById("questionCard"),
    qText: document.getElementById("qText"),
    answerInput: document.getElementById("answerInput"),
    svarBtn: document.getElementById("svarBtn"),
    answerMsg: document.getElementById("answerMsg"),
    streakAck: document.getElementById("streakAck"),

    monster: document.getElementById("monster"),

    lineWrap: document.getElementById("lineWrap"),
    lineTitle: document.getElementById("lineTitle"),
    line: document.getElementById("line"),

    sliderRow: document.getElementById("sliderRow"),
    sliderTrack: document.getElementById("sliderTrack"),
    lineSlider: document.getElementById("lineSlider"),
    sliderPill: document.getElementById("sliderPill"),

    stars: document.getElementById("stars"),
    starsHelp: document.getElementById("starsHelp")
  };

  function randInt(min, max){
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }
  function setPill(btn, pressed){
    btn.setAttribute("aria-pressed", pressed ? "true" : "false");
  }
  function setMessage(node, text, kind){
    node.textContent = text || "";
    node.classList.remove("good","warn","bad");
    if(kind) node.classList.add(kind);
  }
  function nameOrFallback(){
    return state.name?.trim() ? state.name.trim() : "ven";
  }

  const praiseLines = [
    (n) => `Flot arbejde, ${n}!`,
    (n) => `Mega sejt, ${n}!`,
    (n) => `Du er virkelig god, ${n}!`,
    (n) => `Yes! Det sad lige i skabet, ${n}!`,
    (n) => `St√¶rkt g√•et, ${n}!`
  ];
  function randomPraise(){
    return praiseLines[randInt(0, praiseLines.length - 1)](nameOrFallback());
  }

  function playSuccessSound(){
    try{
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      const ctx = new AudioCtx();
      const now = ctx.currentTime;
      const notes = [523.25, 659.25, 783.99];
      notes.forEach((freq, i) => {
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "sine";
        o.frequency.value = freq;
        g.gain.setValueAtTime(0.0001, now + i * 0.12);
        g.gain.exponentialRampToValueAtTime(0.14, now + i * 0.12 + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, now + i * 0.12 + 0.11);
        o.connect(g).connect(ctx.destination);
        o.start(now + i * 0.12);
        o.stop(now + i * 0.12 + 0.12);
      });
      setTimeout(() => ctx.close(), 650);
    } catch(e){}
  }

  /* -------------------- Stars as BEST (highscore) -------------------- */
  function starsFromStreak(streak){ return Math.min(5, Math.floor(streak / 5)); }

  function bestStarsKey(){
    const nm = (state.name || "").trim().toLowerCase();
    return `scorezone_math_bestStars::${nm}::${state.op}::lvl${state.level}`;
  }

  function loadBestStars(){
    const nm = (state.name || "").trim();
    if(!nm){
      state.bestStars = 0;
      state.lastBestStarsRendered = 0;
      return 0;
    }
    const raw = localStorage.getItem(bestStarsKey());
    const v = raw ? Number(raw) : 0;
    state.bestStars = Number.isFinite(v) ? Math.max(0, Math.min(5, v)) : 0;
    state.lastBestStarsRendered = state.bestStars;
    return state.bestStars;
  }

  function saveBestStars(v){
    state.bestStars = Math.max(0, Math.min(5, v));
    const nm = (state.name || "").trim();
    if(nm){
      localStorage.setItem(bestStarsKey(), String(state.bestStars));
    }
  }

  function renderStars({ animate } = { animate:true }){
    const filledCount = state.bestStars;

    const stars = [...el.stars.querySelectorAll(".star")];
    stars.forEach((s, idx) => {
      const i = idx + 1;
      const shouldFill = i <= filledCount;

      s.classList.toggle("filled", shouldFill);
      s.textContent = shouldFill ? "‚òÖ" : "‚òÜ";

      if(shouldFill) s.classList.add("glow");
      else s.classList.remove("glow");

      s.classList.remove("pop","dance");
    });

    if(animate && filledCount > state.lastBestStarsRendered){
      for(let i = state.lastBestStarsRendered + 1; i <= filledCount; i++){
        const s = el.stars.querySelector(`.star[data-i="${i}"]`);
        if(!s) continue;
        s.classList.add("pop");
        setTimeout(() => s.classList.add("dance"), 140);
        setTimeout(() => s.classList.remove("pop","dance"), 900);
      }
    }

    state.lastBestStarsRendered = filledCount;
    el.starsHelp.textContent = `Best`;
  }

  /* -------------------- Streak (localStorage) -------------------- */
  function streakKey(){
    const nm = (state.name || "").trim().toLowerCase();
    return `scorezone_math_streak::${nm}::${state.op}::lvl${state.level}`;
  }
  function loadStreak(){
    const nm = (state.name || "").trim();
    if(!nm){
      state.streak = 0;
      return 0;
    }
    const raw = localStorage.getItem(streakKey());
    const v = raw ? Number(raw) : 0;
    state.streak = Number.isFinite(v) ? v : 0;
    return state.streak;
  }
  function saveStreak(v){
    state.streak = v;
    const nm = (state.name || "").trim();
    if(nm) localStorage.setItem(streakKey(), String(v));
    renderStreakEverywhere({ animateStars:true });
  }

  function renderStreakEverywhere({ animateStars } = { animateStars:true }){
    el.streakHeader.textContent = String(state.streak);
    el.streakGame.textContent = String(state.streak);
    el.startStreakText.textContent = `Din streak for denne √∏velse: ${state.streak}`;

    const currentStars = starsFromStreak(state.streak);
    if(currentStars > state.bestStars){
      saveBestStars(currentStars);
    }
    renderStars({ animate: animateStars });
  }

  /* -------------------- Tallinje + slider alignment -------------------- */
  function clearActiveTick(){
    el.line.querySelectorAll(".tick.active").forEach(t => t.classList.remove("active"));
  }
  function setActiveTick(value){
    clearActiveTick();
    const t = el.line.querySelector(`.tick[data-val="${value}"]`);
    if(t) t.classList.add("active");
  }
  function matchSliderToTallinje(){
    const r = el.line.getBoundingClientRect();
    el.sliderTrack.style.width = r.width + "px";
  }
  function bindTallinjeClicksIfLevel1(){
    const clickable = (state.level === 1);
    el.line.querySelectorAll(".tick").forEach(t => {
      t.classList.toggle("clickable", clickable);
      t.onclick = null;
      if(clickable){
        t.onclick = () => {
          el.answerInput.value = t.dataset.val || "";
          el.answerInput.focus();
        };
      }
    });
  }
  function renderTallinje(){
    el.line.innerHTML = "";
    el.sliderRow.classList.add("hidden");

    if(state.level === 1){
      el.lineTitle.textContent = "Tallinje (0‚Äì9)";
      for(let n=0; n<=9; n++){
        const t = document.createElement("div");
        t.className = "tick";
        t.textContent = String(n);
        t.dataset.val = String(n);
        el.line.appendChild(t);
      }
      bindTallinjeClicksIfLevel1();
      return;
    }

    if(state.level === 2){
      el.lineTitle.textContent = "Tallinje (0‚Äì20)";
      for(let n=0; n<=20; n++){
        const t = document.createElement("div");
        t.className = "tick";
        t.textContent = String(n);
        t.dataset.val = String(n);
        el.line.appendChild(t);
      }
      bindTallinjeClicksIfLevel1();
      return;
    }

    el.lineTitle.textContent = "Tallinje (0‚Äì30) + slider";
    for(let n=0; n<=30; n++){
      const t = document.createElement("div");
      t.className = "tick";
      t.textContent = String(n);
      t.dataset.val = String(n);
      el.line.appendChild(t);
    }

    el.sliderRow.classList.remove("hidden");
    el.lineSlider.min = "0";
    el.lineSlider.max = "30";

    bindTallinjeClicksIfLevel1();
    requestAnimationFrame(matchSliderToTallinje);
  }

  el.lineSlider.addEventListener("input", ()=>{
    const v = Number(el.lineSlider.value);
    el.sliderPill.textContent = `Slider: ${v}`;
    setActiveTick(v);

    if(state.level === 3){
      el.answerInput.value = String(v);
    }
  });

  window.addEventListener("resize", () => {
    if(!el.sliderRow.classList.contains("hidden")) matchSliderToTallinje();
    if(el.monster.classList.contains("show")) positionMonsterOver(el.zone2);
  });

  /* -------------------- Cubes -------------------- */
  function randomCubeColor(){ return cubeColors[randInt(0, cubeColors.length - 1)]; }
  function makeCube({ mode, color }){
    const c = document.createElement("div");
    c.className = "cube";
    c.style.background = color || randomCubeColor();

    if(mode === "drag"){
      c.addEventListener("pointerdown", onCubePointerDown);
    } else if(mode === "tapCross"){
      c.style.cursor = "pointer";
      c.addEventListener("click", () => {
        c.classList.toggle("crossed");
        clearZoneMarks();
        syncMinusRemovedBox();
      });
    } else if(mode === "static"){
      c.classList.add("static");
      c.style.cursor = "default";
      c.style.touchAction = "auto";
    } else {
      c.style.cursor = "default";
      c.style.opacity = "0.45";
      c.style.boxShadow = "0 4px 10px rgba(15,23,42,0.10)";
    }
    return c;
  }
  function clearZoneMarks(){
    el.zone1.classList.remove("correct","wrong");
    el.zone2.classList.remove("correct","wrong");
  }

  /* -------------------- Drag (Level 2 PLUS only) -------------------- */
  let drag = { src:null, ghost:null, offsetX:0, offsetY:0, startParent:null };

  function onCubePointerDown(e){
    if(state.level !== 2) return;
    if(state.op !== "plus") return;

    const src = e.currentTarget;
    drag.src = src;
    drag.startParent = src.parentElement;

    const rect = src.getBoundingClientRect();
    drag.offsetX = e.clientX - rect.left;
    drag.offsetY = e.clientY - rect.top;

    const ghost = src.cloneNode(true);
    ghost.classList.add("ghost");
    ghost.style.width = rect.width + "px";
    ghost.style.height = rect.height + "px";
    ghost.style.left = rect.left + "px";
    ghost.style.top = rect.top + "px";
    document.body.appendChild(ghost);
    drag.ghost = ghost;

    src.style.opacity = "0.15";

    src.setPointerCapture(e.pointerId);
    src.addEventListener("pointermove", onCubePointerMove);
    src.addEventListener("pointerup", onCubePointerUp, { once:true });
  }
  function onCubePointerMove(e){
    if(!drag.ghost) return;
    drag.ghost.style.left = (e.clientX - drag.offsetX) + "px";
    drag.ghost.style.top  = (e.clientY - drag.offsetY) + "px";
  }
  function getDropTarget(x, y){
    const targets = [el.zone1, el.zone2, el.pileArea];
    for(const t of targets){
      if(t.closest(".hidden")) continue;
      const r = t.getBoundingClientRect();
      if(x >= r.left && x <= r.right && y >= r.top && y <= r.bottom) return t;
    }
    return null;
  }
  function onCubePointerUp(e){
    const src = drag.src;
    const ghost = drag.ghost;
    if(!src) return;

    src.removeEventListener("pointermove", onCubePointerMove);

    const target = getDropTarget(e.clientX, e.clientY);

    src.style.opacity = "";
    if(target) target.appendChild(src);
    else drag.startParent.appendChild(src);

    if(ghost) ghost.remove();
    drag = { src:null, ghost:null, offsetX:0, offsetY:0, startParent:null };
    clearZoneMarks();
  }

  /* -------------------- Numbers / rounds (NO repeat) -------------------- */
  function problemKey(op, level, a, b){
    if(op === "plus"){
      const lo = Math.min(a,b);
      const hi = Math.max(a,b);
      return `${op}|lvl${level}|${lo}|${hi}`;
    }
    return `${op}|lvl${level}|${a}|${b}`;
  }
  function generateOnePair(){
    let a = 0, b = 0;

    if(state.level === 1){
      if(state.op === "plus"){
        a = randInt(1, 8);
        b = randInt(1, 9 - a);
      } else {
        a = randInt(2, 6);
        b = randInt(1, a);
      }
    }

    if(state.level === 2){
      if(state.op === "plus"){
        a = randInt(4, 8);
        b = randInt(1, 9 - a);
      } else {
        a = randInt(1, 20);
        b = randInt(1, a);
      }
    }

    if(state.level === 3){
      if(state.op === "plus"){
        a = randInt(0, 30);
        b = randInt(0, 30 - a);
      } else {
        a = randInt(0, 30);
        b = randInt(0, a);
      }
    }

    return { a, b };
  }
  function pickNumbers(){
    let tries = 0;
    while(true){
      tries++;
      const { a, b } = generateOnePair();
      const key = problemKey(state.op, state.level, a, b);
      if(key !== state.lastProblemKey || tries >= 60){
        state.n1 = a;
        state.n2 = b;
        state.lastProblemKey = key;
        state.round++;
        break;
      }
    }

    el.n1.textContent = String(state.n1);
    el.n2.textContent = String(state.n2);

    const sign = (state.op === "plus") ? "+" : "‚àí";
    el.opSign.textContent = sign;
    el.opSignMobile.textContent = sign;
  }

  function showQuestionStage({ replacePile } = { replacePile:true }){
    const opSymbol = (state.op === "plus") ? "+" : "‚àí";
    el.qText.textContent = `Hvad er ${state.n1} ${opSymbol} ${state.n2}?`;
    el.questionCard.classList.remove("hidden");
    el.answerInput.focus();

    if(replacePile && state.op === "plus" && state.level === 2){
      el.pileWrap.classList.add("hidden");
    }
  }
  function correctAnswerValue(){
    return (state.op === "plus") ? (state.n1 + state.n2) : (state.n1 - state.n2);
  }

  function resetUIForNewRound(){
    setMessage(el.cubeMsg, "", null);
    setMessage(el.answerMsg, "", null);
    el.streakAck.textContent = "";
    clearZoneMarks();

    el.klarBtn.disabled = false;
    el.questionCard.classList.add("hidden");
    el.answerInput.value = "";
    state.pendingMinusReward = false;

    el.pileWrap.classList.remove("hidden");
    el.zone1.innerHTML = "";
    el.zone2.innerHTML = "";
    el.pileArea.innerHTML = "";

    el.klarBtn.classList.remove("hidden");
    el.n1.classList.remove("primaryPick");

    if(state.level === 3){
      el.hint1.textContent = "Brug slideren til at finde et tal";
      el.hint2.textContent = "Brug slideren til at finde et tal";
      el.pileWrap.classList.add("hidden");
      el.klarBtn.disabled = true;
      el.klarBtn.classList.add("hidden");

      el.n1.classList.add("primaryPick");
      el.lineSlider.value = String(state.n1);
      el.sliderPill.textContent = `Slider: ${state.n1}`;
      setActiveTick(state.n1);

      showQuestionStage({ replacePile:false });
      el.answerInput.value = String(state.n1);

      requestAnimationFrame(matchSliderToTallinje);
      return;
    }

    if(state.level === 1){
      el.klarBtn.classList.add("hidden");

      if(state.op === "plus"){
        el.hint1.textContent = "T√¶l klodserne";
        el.hint2.textContent = "T√¶l klodserne";
        el.pileWrap.classList.add("hidden");

        for(let i=0;i<state.n1;i++) el.zone1.appendChild(makeCube({ mode:"static" }));
        for(let i=0;i<state.n2;i++) el.zone2.appendChild(makeCube({ mode:"static" }));

        setMessage(el.cubeMsg, "Tryk p√• et tal p√• tallinjen og tryk Svar.", "warn");
        showQuestionStage({ replacePile:false });
        return;
      }

      el.hint1.textContent = "Tryk p√• klodser for at krydse dem ud";
      el.hint2.textContent = "Her kan du t√¶lle dem du tog v√¶k";
      el.pileWrap.classList.add("hidden");

      for(let i=0;i<state.n1;i++){
        el.zone1.appendChild(makeCube({ mode:"tapCross" }));
      }
      syncMinusRemovedBox();

      setMessage(el.cubeMsg, "Kryds det rigtige antal ud. V√¶lg svar p√• tallinjen og tryk Svar.", "warn");
      showQuestionStage({ replacePile:false });
      return;
    }

    if(state.level === 2){
      if(state.op === "plus"){
        el.hint1.textContent = "Tr√¶k klodser herned";
        el.hint2.textContent = "Tr√¶k klodser herned";
        el.pileTitle.textContent = "Klodse-bunke";
        el.pileHint.textContent = "Tr√¶k klodser op i boksene";

        const cubeCount = 20;
        for(let i=0;i<cubeCount;i++){
          el.pileArea.appendChild(makeCube({ mode:"drag" }));
        }
      } else {
        el.hint1.textContent = "Tryk p√• klodser for at krydse dem ud";
        el.hint2.textContent = "Her kan du t√¶lle dem du tog v√¶k";
        el.pileWrap.classList.add("hidden");

        for(let i=0;i<state.n1;i++){
          el.zone1.appendChild(makeCube({ mode:"tapCross" }));
        }
        syncMinusRemovedBox();
      }
    }
  }

  function startRound(){
    pickNumbers();
    renderTallinje();
    requestAnimationFrame(() => {
      if(!el.sliderRow.classList.contains("hidden")) matchSliderToTallinje();
    });
    resetUIForNewRound();
  }

  function syncMinusRemovedBox(){
    if(state.op !== "minus") return;
    if(!(state.level === 1 || state.level === 2)) return;

    const crossed = [...el.zone1.querySelectorAll(".cube.crossed")];
    el.zone2.innerHTML = "";
    crossed.forEach(src => {
      el.zone2.appendChild(makeCube({ mode:"static", color: src.style.background }));
    });

    if(state.level === 2){
      setMessage(el.cubeMsg, `Krydset ud: ${crossed.length} / ${state.n2}`, "warn");
    }
  }

  function clearMonsterClasses(){
    el.monster.classList.remove("run-in","run-chomp","run-turn","run-out","show");
  }
  function positionMonsterOver(targetEl){
    const r = targetEl.getBoundingClientRect();
    const mW = 160, mH = 120;

    let left = r.left + (r.width / 2) - (mW / 2);
    let top  = r.top  + (r.height / 2) - (mH / 2);

    left = Math.max(10, Math.min(left, window.innerWidth  - mW - 10));
    top  = Math.max(10, Math.min(top,  window.innerHeight - mH - 10));

    el.monster.style.left = left + "px";
    el.monster.style.top  = top + "px";
  }
  function playMonsterPhase(className, ms){
    return new Promise((resolve) => {
      clearMonsterClasses();
      el.monster.classList.add("show", className);
      setTimeout(resolve, ms);
    });
  }
  async function monsterEatRemovedCubes(){
    positionMonsterOver(el.zone2);
    await playMonsterPhase("run-in", 420);

    const removedCubes = [...el.zone2.querySelectorAll(".cube")];
    const crossedCubes = [...el.zone1.querySelectorAll(".cube.crossed")];

    const chompPromise = playMonsterPhase("run-chomp", 520);

    removedCubes.forEach((c, i) => {
      setTimeout(() => {
        c.style.transition = "transform 180ms ease, opacity 180ms ease";
        c.style.transform = "scale(0.15)";
        c.style.opacity = "0";
        setTimeout(() => c.remove(), 220);
      }, 80 + i * 30);
    });

    crossedCubes.forEach((c, i) => {
      setTimeout(() => {
        c.style.transition = "transform 180ms ease, opacity 180ms ease";
        c.style.transform = "scale(0.15)";
        c.style.opacity = "0";
        setTimeout(() => c.remove(), 220);
      }, 80 + i * 24);
    });

    await chompPromise;
    await playMonsterPhase("run-turn", 260);
    await playMonsterPhase("run-out", 420);
    clearMonsterClasses();
  }

  function validateCubes(){
    if(state.level !== 2) return;

    if(state.op === "plus"){
      const c1 = el.zone1.querySelectorAll(".cube").length;
      const c2 = el.zone2.querySelectorAll(".cube").length;

      const ok1 = (c1 === state.n1);
      const ok2 = (c2 === state.n2);

      el.zone1.classList.toggle("correct", ok1);
      el.zone1.classList.toggle("wrong", !ok1);
      el.zone2.classList.toggle("correct", ok2);
      el.zone2.classList.toggle("wrong", !ok2);

      if(ok1 && ok2){
        setMessage(el.cubeMsg, randomPraise() + " Klodserne passer!", "good");
        el.klarBtn.disabled = true;
        playSuccessSound();
        showQuestionStage({ replacePile:true });
      } else {
        setMessage(el.cubeMsg, "Pr√∏v igen. Se hvilke bokse der er rigtige.", "warn");
      }
      return;
    }

    const crossed = el.zone1.querySelectorAll(".cube.crossed").length;
    const ok = (crossed === state.n2);

    el.zone1.classList.toggle("correct", ok);
    el.zone1.classList.toggle("wrong", !ok);
    el.zone2.classList.toggle("correct", ok);
    el.zone2.classList.toggle("wrong", !ok);

    if(ok){
      setMessage(el.cubeMsg, randomPraise() + " Du tog det rigtige antal v√¶k!", "good");
      el.klarBtn.disabled = true;
      playSuccessSound();
      state.pendingMinusReward = true;
      showQuestionStage({ replacePile:false });
    } else {
      setMessage(el.cubeMsg, `Pr√∏v igen. Krydset ud: ${crossed} / ${state.n2}`, "warn");
    }
  }

  function submitAnswer(){
    if(state.level === 1 && state.op === "minus"){
      const crossed = el.zone1.querySelectorAll(".cube.crossed").length;
      if(crossed !== state.n2){
        setMessage(el.answerMsg, `F√∏rst: kryds ${state.n2} klodser ud. Du har krydset ${crossed} ud.`, "warn");
        return;
      }
    }

    const v = Number(el.answerInput.value);
    const correct = correctAnswerValue();

    if(!Number.isFinite(v)){
      setMessage(el.answerMsg, "Skriv et tal (eller tryk p√• tallinjen).", "warn");
      el.answerInput.focus();
      return;
    }

    const isCorrect = (v === correct);

    if(isCorrect){
      const newStreak = state.streak + 1;
      saveStreak(newStreak);

      setMessage(el.answerMsg, `${randomPraise()} Det er rigtigt!`, "good");
      el.streakAck.textContent = `Streak: ${newStreak} ‚Äì forts√¶t s√•dan!`;
      playSuccessSound();

      if(state.op === "minus" && (state.level === 1 || state.level === 2)){
        monsterEatRemovedCubes().catch(() => {});
      }
    } else {
      saveStreak(0);
      setMessage(el.answerMsg, `Ikke helt. Det rigtige svar er ${correct}.`, "bad");
      el.streakAck.textContent = "Streak nulstilles ‚Äì du pr√∏ver bare igen.";
    }

    setTimeout(() => {
      startRound();
      updateModeText();
    }, 1400);
  }

  function goToStartScreen(){
    el.gameScreen.classList.add("hidden");
    el.startScreen.classList.remove("hidden");

    loadStreak();
    loadBestStars();
    renderStreakEverywhere({ animateStars:false });
    updateHello();
  }

  function goToGameScreen(){
    el.startScreen.classList.add("hidden");
    el.gameScreen.classList.remove("hidden");

    loadStreak();
    loadBestStars();
    renderStreakEverywhere({ animateStars:false });

    updateModeText();
    startRound();
  }

  function updateHello(){
    const nm = (state.name || "").trim();
    el.helloText.textContent = nm ? `Hej ${nm}!` : "";
  }

  function updateModeText(){
    const opText = (state.op === "plus") ? "Plus (+)" : "Minus (‚àí)";
    el.modeText.textContent = `${opText} ‚Ä¢ Level ${state.level}`;
  }

  function updateStartStreakPreview(){
    loadStreak();
    loadBestStars();
    renderStreakEverywhere({ animateStars:false });
  }

  function setOp(op){
    state.op = op;
    setPill(el.opPlus, op === "plus");
    setPill(el.opMinus, op === "minus");
    updateStartStreakPreview();
  }

  function setLevel(level){
    state.level = level;
    setPill(el.lvl1, level === 1);
    setPill(el.lvl2, level === 2);
    setPill(el.lvl3, level === 3);
    updateStartStreakPreview();
  }

  el.studentName.addEventListener("input", () => {
    state.name = (el.studentName.value || "").trim();
    updateHello();
    updateStartStreakPreview();
  });

  el.opPlus.addEventListener("click", () => setOp("plus"));
  el.opMinus.addEventListener("click", () => setOp("minus"));

  el.lvl1.addEventListener("click", () => setLevel(1));
  el.lvl2.addEventListener("click", () => setLevel(2));
  el.lvl3.addEventListener("click", () => setLevel(3));

  el.goBtn.addEventListener("click", () => {
    state.name = (el.studentName.value || "").trim();
    updateHello();
    goToGameScreen();
  });

  el.backBtn.addEventListener("click", () => goToStartScreen());

  el.klarBtn.addEventListener("click", validateCubes);

  el.svarBtn.addEventListener("click", submitAnswer);
  el.answerInput.addEventListener("keydown", (e) => {
    if(e.key === "Enter") submitAnswer();
  });

  // Init
  setOp("plus");
  setLevel(1);
  state.name = "";
  loadStreak();
  loadBestStars();
  renderStreakEverywhere({ animateStars:false });
  updateHello();
})();
</script>
</body>
</html>

